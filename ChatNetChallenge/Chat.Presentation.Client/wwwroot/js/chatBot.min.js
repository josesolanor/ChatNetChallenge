var connection=(new signalR.HubConnectionBuilder).withUrl("/chatHub").build();function chatModal(){$.ajax({url:urlGetAllChatMessages,type:"GET"}).done(function(e){var a=JSON.parse(e);cleanMessageBox(),createChatMessage(a),makeScrollBottom()})}function chatModalSignalr(e){loadMessages(e),makeScrollBottom()}function cleanMessageBox(){for(var e=document.getElementById("chatBody");e.hasChildNodes();)e.removeChild(e.firstChild)}function createChatMessage(e){e.forEach(loadMessages)}function loadMessages(e,a){var t=document.getElementById("chatBody"),n=document.createElement("li");n.classList.add("left"),n.classList.add("clearfix");var l=document.createElement("div");l.classList.add("chat-body"),l.classList.add("clearfix");var d=document.createElement("div");d.classList.add("header");var o=document.createElement("p"),c=document.createTextNode(e.TextMessage);o.appendChild(c);var s=document.createElement("strong");s.classList.add("primary-font");var i=document.createTextNode(e.User.FullName);s.appendChild(i);var r=document.createElement("small");r.classList.add("pull-right"),r.classList.add("text-muted");c=document.createTextNode(e.DateOnText);r.appendChild(c);var u=document.createElement("span");u.classList.add("glyphicon"),u.classList.add("glyphicon-time"),r.appendChild(u),d.appendChild(s),d.appendChild(r),l.appendChild(d),l.appendChild(o),n.appendChild(l),t.appendChild(n)}function makeScrollBottom(){$("div.panel-body").scrollTop($("div.panel-body").prop("scrollHeight"))}connection.on("Message",function(e){chatModalSignalr(JSON.parse(e))}),connection.start().catch(function(e){return console.error(e.toString())}),$(function(){chatModal()}),$("#btn_chat").click(function(){var e=$("#btn_input").val();""==e?alert("Error, El mensaje esta en blanco"):$.ajax({url:urlSendMessage,type:"POST",data:{TextMessage:e,UserEmail:emailUserFromIdentity}}).done(function(){$("#btn_input").val("")}).fail(function(){alert("Mensaje no enviado, error en la solicitud")})});